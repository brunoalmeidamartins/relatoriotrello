<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Conversor Trello - ESPAÇO CONAFER</title>
        <link href="css/styles.css" rel="stylesheet" />
        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/jspdf@latest/dist/jspdf.min.js"></script>
    </head>
    <body class="sb-nav-fixed">

        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <a class="navbar-brand" href="index.html">ADM ESPAÇO CONAFER</a><button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#"><i class="fas fa-bars"></i></button>
            <ul class="navbar-nav d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="userDropdown" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-user fa-fw"></i> Administrador</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                        <a class="dropdown-item" href="#">Meu Perfil</a><a class="dropdown-item" href="#">Log de Ações</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="login.html">Sair</a>
                    </div>
                </li>
            </ul>
        </nav>

        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <div class="sb-sidenav-menu-heading">Principal</div>
                                <a class="nav-link collapsed" href="index.html">
                                    <div class="sb-nav-link-icon">
                                        <i class="fas fa-users-cog"></i>
                                    </div>
                                    Dashboard
                                </a>
                            <div class="sb-sidenav-menu-heading">Relatórios</div>
                                <a class="nav-link" href="conversao_trello.html">
                                    <div class="sb-nav-link-icon">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    Conversor Trello
                                </a>
                        </div>
                    </div>
                    <div class="sb-sidenav-footer">
                        <div class="small">Logado como:</div>
                        Administrador
                    </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid">

                        <h1 class="mt-4">Conversor Trello</h1>

                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item active">Relatórios -> Conversor Trello</li>
                        </ol>

                        <div class="row">

                            <div class="col-xl-4 col-md-6" id="selecione">
                                <div class="card mb-4">
                                    <div class="card-header"><i class="fas fa-chart-area mr-1"></i>Selecione o relatório JSON exportado do Trello:</div>
                                    <div class="card-body">
                                    <form>
                                      <div class="form-group">
                                        <input type="file" class="form-control-file" id="jsonfile" name="jsonfile" autocomplete="off">
                                      </div>
                                      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Iniciar Conversão</button>
                                    </form>
                                    </div>
                                </div>
                               
                            </div>

                            <!-- Modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                              <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Configurando Relatório</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>
                                  <div class="modal-body member_etiqueta_association">
                                    
                                   
                                  </div>
                                  <div class="modal-body date_interval">
                                    
                                   
                                    </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" onClick="configMember()">Gerar Relatório</button>
                                  </div>
                                </div>
                              </div>
                            </div>

                        </div>
                         <div class='card mb-12 card_principal' id='card_principal'></div>
                        <iframe id='iframe' height="595.28" src="about:blank" width="841.89" >
                          
                        </iframe> 
                        <button type='button' class='btn btn-primary' onClick='getPDF()'>Baixar PDF</button>
                    </div>
                </main>
                <footer class="py-4 bg-light mt-auto">
                    <div class="container-fluid">
                        <div class="d-flex align-items-center justify-content-between small">
                            <div class="text-muted">Copyright &copy; ADM ESPAÇO CONAFER 2020</div>
                            <div>
                                <a href="#">Desenvolvedores &amp; Documentação</a>
                                &middot;
                                <a href="#">Política de Privacidade</a>
                                &middot;
                                <a href="#">Termos &amp; Condições</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>

        <script>
            var membros_acoes_geral = [];
            var cardsFromJson = [];
            function shadeColor(color, percent) {

                var R = parseInt(color.substring(1,3),16);
                var G = parseInt(color.substring(3,5),16);
                var B = parseInt(color.substring(5,7),16);

                R = parseInt(R * (100 + percent) / 100);
                G = parseInt(G * (100 + percent) / 100);
                B = parseInt(B * (100 + percent) / 100);

                R = (R<255)?R:255;  
                G = (G<255)?G:255;  
                B = (B<255)?B:255;  

                var RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
                var GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
                var BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

                return "#"+RR+GG+BB;
            }

           
        function populateColumn(i,cards,column_id,column_color,column_name,membro_corpo_colunas,color){
            if (cards.length>0){
              //  $(div_card_member_body).append("<div>"+column+"</div>");

                var membro_corpo_coluna = $("<div class='my-1 p-1 rounded box-shadow' id=''></div>");
                var membro_corpo_coluna_titulo = $("<h6 class='pb-2 mb-0' style='background-color: "+column_color+"; color:white;text-align:left;padding-left: 10px;'><button id='column_"+column_id+"_member_"+i+"' onClick='deleteThisColumn(&#34;"+column_id+"&#34;,"+i+")' class='btn btn-danger btn-sm x_button'>x</button>"+column_name+"</h6>");
                var membro_corpo_coluna_corpo = $("<div id=''></div>");
                 
                       
                for(let m=cards.length-1;m>=0;m--){
                   // alert(cards[m].name)
                        var membro_corpo_coluna_corpo_atividade = $("<div class='border-bottom border-gray' style='padding-bottom: 10px;'></div>");
                        var membro_corpo_coluna_corpo_atividade_titulo = $("<div class='media text-muted pt-3'></div>");

                        var createDate = (cards[m].actions[0]!=undefined) ? cards[m].actions[0].date.split("T") : false;

                        if (createDate!=false){
                            var createDate_formated = createDate[0].split("-");
                        }
                        let description = "";

                        if (cards[m].description!=""){
                            description = "<span><button id='column_"+column_id+"_member_"+i+"_card_"+m+"_descrition' onClick='deleteThisDescription(&#34;"+column_id+"&#34;,"+i+","+m+")' class='btn btn-danger btn-sm x_button'>x</button>"+cards[m].description+"</span>";
                        }

                        let members = ""

                        if (cards[m].members.length>0){
                            members = "Participação de: \n";
                            cards[m].members.forEach(member => {
                                members +=  member.name+" | "
                            })
                            
                        }

                        var membro_corpo_coluna_corpo_atividade_titulo_titulo = $("<button id='column_"+column_id+"_atv_member_"+i+"_card_"+m+"' onClick='deleteThisCard(&#34;"+column_id+"&#34;,"+i+","+m+")' class='btn btn-danger btn-sm x_button'>x</button><p class='media-body pb-3 mb-0 small lh-125'><strong class='d-block' style='color:dimgrey;font-size: 16px;'>"+cards[m].name+((createDate!=false) ? " [Início em "+createDate_formated[2]+"/"+createDate_formated[1]+"/"+createDate_formated[0]+"]</strong>":"</strong>")+description+"<br/>"+members+"</p>");
                                
                        $(membro_corpo_coluna_corpo_atividade_titulo).append(membro_corpo_coluna_corpo_atividade_titulo_titulo);
                        $(membro_corpo_coluna_corpo_atividade).append(membro_corpo_coluna_corpo_atividade_titulo);

                        var membro_corpo_coluna_corpo_atividade_roteiro = $("<ul class='events media-body small lh-125' style='margin-top: 8px;margin-bottom:0px;'></ul>");


                        for (r=0;r<cards[m].actions.length;r++){
                            switch(cards[m].actions[r].type){
                              
                                case "commentCard":
                                
                                var membro_corpo_coluna_corpo_atividade_roteiro_item = $("<li id='member_"+i+"_card_"+m+"_action_"+r+"'><button id='column_"+column_id+"_member_"+i+"_card_"+m+"_action_"+r+"' onClick='deleteThisAction(&#34;"+column_id+"&#34;,"+i+","+m+","+r+")' class='btn btn-danger btn-sm x_button'>x</button></li>");

                                var formatDate = cards[m].actions[r].date.split("T");
                                var formatDate_ = formatDate[0].split("-");

                                var membro_corpo_coluna_corpo_atividade_roteiro_item_time = $("<time datetime='' style='color:#787878'>"+formatDate_[2]+"/"+formatDate_[1]+"/"+formatDate_[0]+"</time>");
                                var membro_corpo_coluna_corpo_atividade_roteiro_item_span = $("<span  style='color:gray'>"+cards[m].actions[r].text+"</span>");
                                
                                $(membro_corpo_coluna_corpo_atividade_roteiro_item).append(membro_corpo_coluna_corpo_atividade_roteiro_item_time);

                                $(membro_corpo_coluna_corpo_atividade_roteiro_item).append(membro_corpo_coluna_corpo_atividade_roteiro_item_span);

                                $(membro_corpo_coluna_corpo_atividade_roteiro).append(membro_corpo_coluna_corpo_atividade_roteiro_item);
                                break;
                            }
                        }

                        $(membro_corpo_coluna_corpo_atividade).append(membro_corpo_coluna_corpo_atividade_roteiro);

                        var membro_corpo_coluna_corpo_atividade_outros = $("<div class='row'></div>");
                        
                        if(cards[m].checklists.length>0){
                            var membro_corpo_coluna_corpo_atividade_checklists = $("<div class='col-md-7'></div>");
        
                            for (r=0;r<cards[m].checklists.length;r++){
                                var membro_corpo_coluna_corpo_atividade_checklist = $("<ul class='events media-body small lh-125' style='margin-top: 8px;margin-bottom:0px;'></ul>");
                                var membro_corpo_coluna_corpo_atividade_checklist_titulo = $("<li id='member_"+i+"_card_"+m+"_action_"+r+"'><b style='color:dimgrey'><button id='column_"+column_id+"_member_"+i+"_card_"+m+"_checklist_"+r+"' onClick='deleteThisChecklist(&#34;"+column_id+"&#34;"+","+i+","+m+","+r+")' class='btn btn-danger btn-sm x_button'>x</button>> "+cards[m].checklists[r].name+"</b></li>");

                                $(membro_corpo_coluna_corpo_atividade_checklist).append(membro_corpo_coluna_corpo_atividade_checklist_titulo);

                                var n=0;
                                
                                for (n=0;n<cards[m].checklists[r].items.length;n++){
                                    var membro_corpo_coluna_corpo_atividade_checklist_item = $("<li id='member_"+i+"_card_"+m+"_action_"+r+"'></li>");
                                    var membro_corpo_coluna_corpo_atividade_checklist_item_div = $("<div id='item__membro_"+i+"_atividade_"+m+"_checklist_"+r+"_item_"+n+"' class='custom-control custom-checkbox'><button id='column_"+column_id+"_member_"+i+"_card_"+m+"_checklist_"+r+"_item_"+n+"' onClick='deleteThisChecklistItem(&#34;"+column_id+"&#34;,"+i+","+m+","+r+","+n+")' class='btn btn-danger btn-sm x_button'>x</button></div>");
                                   
                                    var membro_corpo_coluna_corpo_atividade_checklist_item_div_input;

                                    if(cards[m].checklists[r].items[n].status == "incomplete"){
                                        membro_corpo_coluna_corpo_atividade_checklist_item_div_input = $("<input type='checkbox' class='custom-control-input' id='input__membro_"+i+"_atividade_"+m+"_checklist_"+r+"_item_"+n+"' disabled>");
                                    } else {
                                        membro_corpo_coluna_corpo_atividade_checklist_item_div_input = $("<input type='checkbox' class='custom-control-input' id='input__membro_"+i+"_atividade_"+m+"_checklist_"+r+"_item_"+n+"' checked disabled>");
                                    }
                                    var membro_corpo_coluna_corpo_atividade_checklist_item_div_label = $("<label class='custom-control-label' style='width:440px;font-size:10px;'  id='membro_"+i+"_atividade_"+m+"_checklist_"+r+"_item_"+n+"' for='input__membro_"+i+"_atividade_"+m+"_checklist_"+r+"_item_"+n+"'>"+cards[m].checklists[r].items[n].name+"</label>");
                                    
                                    $(membro_corpo_coluna_corpo_atividade_checklist_item_div).append(membro_corpo_coluna_corpo_atividade_checklist_item_div_input);
                                    $(membro_corpo_coluna_corpo_atividade_checklist_item_div).append(membro_corpo_coluna_corpo_atividade_checklist_item_div_label);
                                    
                                    $(membro_corpo_coluna_corpo_atividade_checklist_item).append(membro_corpo_coluna_corpo_atividade_checklist_item_div);
                                    $(membro_corpo_coluna_corpo_atividade_checklist).append(membro_corpo_coluna_corpo_atividade_checklist_item);
                                }

                                $(membro_corpo_coluna_corpo_atividade_checklists).append(membro_corpo_coluna_corpo_atividade_checklist);
                            }

                            $(membro_corpo_coluna_corpo_atividade_outros).append(membro_corpo_coluna_corpo_atividade_checklists);
                            
                        }
        
        
                        if(cards[m].attachments.length>0){
                            var membro_corpo_coluna_corpo_atividade_anexos = $("<div class='col-md-4'></div>");
        
                            var membro_corpo_coluna_corpo_atividade_anexo = $("<ul class='events media-body small lh-125' style='margin-top: 8px;margin-bottom:0px;'></ul>");
                            var membro_corpo_coluna_corpo_atividade_anexo_titulo = $("<li id='member_"+i+"_card_"+m+"_action_"+r+"'><button id='column_"+column_id+"_member_"+i+"_card_"+m+"_attachments' onClick='deleteThisAttachments(&#34;"+column_id+"&#34;,"+i+","+m+")' class='btn btn-danger btn-sm x_button'>x</button><b style='color:dimgrey'>> Anexos</b></li>");

                            $(membro_corpo_coluna_corpo_atividade_anexo).append(membro_corpo_coluna_corpo_atividade_anexo_titulo);
                               
                            for (r=0;r<cards[m].attachments.length;r++){
                                var membro_corpo_coluna_corpo_atividade_anexo_item = $("<li id='member_"+i+"_card_"+m+"_action_"+r+"' style='display: block'><button id='column_"+column_id+"_member_"+i+"_card_"+m+"_anexo_"+r+"' onClick='deleteThisAttachment(&#34;"+column_id+"&#34;,"+i+","+m+","+r+")' class='btn btn-danger btn-sm x_button'>x</button><a href='#"+cards[m].attachments[r].url+"'>"+cards[m].attachments[r].url+"</a></li>");
                            
                                $(membro_corpo_coluna_corpo_atividade_anexo).append(membro_corpo_coluna_corpo_atividade_anexo_item);

                                $(membro_corpo_coluna_corpo_atividade_anexos).append(membro_corpo_coluna_corpo_atividade_anexo);
                            }
                            
                            $(membro_corpo_coluna_corpo_atividade_outros).append(membro_corpo_coluna_corpo_atividade_anexos);
                        }

                        $(membro_corpo_coluna_corpo_atividade).append(membro_corpo_coluna_corpo_atividade_outros);
                        
                        $(membro_corpo_coluna_corpo).append(membro_corpo_coluna_corpo_atividade);
        
                    }

                $(membro_corpo_coluna).append(membro_corpo_coluna_titulo);
                $(membro_corpo_coluna).append(membro_corpo_coluna_corpo);
                
                $(membro_corpo_colunas).append(membro_corpo_coluna);

            }   
        }
           
        function getPDF(){
            $(".x_button").replaceWith(function() { return null; });

            $("#iframe").contents().find(".x_button").replaceWith(function(){ return null;});
                    
            $("#iframe").get(0).contentWindow.print();
        
        }

        
        function configMember(){
            var startDate = document.getElementById("date_interval_init").value;
            var endDate = document.getElementById("date_interval_end").value;
            let entidade = [];
            
            var startDate_ = startDate.split("-");
                
                var endDate_ = endDate.split("-");

                var cabecalho = $("<div class='row'></div>");
                var cabecalho_titulo = $("<h6 style='margin-left: 10px;'>RELATÓRIO ESPAÇO CONAFER RORAIMA ["+startDate_[2]+"/"+startDate_[1]+"/"+startDate_[0]+" - "+endDate_[2]+"/"+endDate_[1]+"/"+endDate_[0]+"]</h6>");
                var membros = $("<div class='row'></div>");
                $(cabecalho).append(cabecalho_titulo);

                var script_jquery = '<script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"><';

                script_jquery += '/script>';

                var script_ = '<script> function deleteThisAction(column,member,card,action){ document.getElementById("column_"+column+"_member_"+member+"_card_"+card+"_action_"+action).parentElement.replaceWith("");}';

                script_ += 'function deleteThisChecklist(column,member,card,checklist){ document.getElementById("column_"+column+"_member_"+member+"_card_"+card+"_checklist_"+checklist).parentElement.parentElement.parentElement.parentElement.replaceWith("");}';

                script_ += 'function deleteThisAttachments (column,member,card){document.getElementById("column_"+column+"_member_"+member+"_card_"+card+"_attachments").parentElement.parentElement.replaceWith("");}';

                script_ += 'function deleteThisAttachment (column,member,card,anexo){document.getElementById("column_"+column+"_member_"+member+"_card_"+card+"_anexo_"+anexo).parentElement.replaceWith("");}';

                script_ += 'function deleteThisChecklistItem(column,member,card,checklist,item){ document.getElementById("column_"+column+"_member_"+member+"_card_"+card+"_checklist_"+checklist+"_item_"+item).parentElement.parentElement.replaceWith("");}';
                
                script_ += 'function deleteThisCard(column,member,card){document.getElementById("column_"+column+"_atv_member_"+member+"_card_"+card).parentElement.parentElement.replaceWith("");}';

                script_ += 'function deleteThisDescription(column,member,card){document.getElementById("column_"+column+"_member_"+member+"_card_"+card+"_descrition").parentElement.replaceWith("");}';

                script_ += 'function deleteThisColumn(column,member){document.getElementById("column_"+column+"_member_"+member).parentElement.parentElement.replaceWith("");}<';


                script_ += '/script>';

            for (let z=0;z<cardsFromJson.length;z++){
                let color_;
                switch(cardsFromJson[z].color){
                    case "blue":
                        color_ = "#326da8";
                        break;
                    case "pink":
                        color_ = "#cc45aa";
                        break;
                    case "yellow":
                        color_ = "#c7bc44";
                        break;
                    case "black":
                        color_ = "#a3a3a3";
                        break;
                    case "purple":
                        color_ = "#9647d6";
                        break;
                    case "sky":
                        color_ = "#47bcd6";
                        break;
                    case "red":
                        color_ = "#b35050";
                        break;
                    case "green":
                        color_ = "#54b352";
                        break;
                    case "orange":
                        color_ = "#cc891d";
                        break;
                    default:
                        color_ = cardsFromJson[z].color;
                        break;

                }

                let cargo = document.getElementById("cargo_"+z).value;

                var membro_completo = $("<div class='col-md-12' style='margin-bottom:15px;'></div>");
                var membro = $("<div class='row'></div>");
                var membro_listra = $("<div class='col-md-1' style='background-color: "+color_+";'></div>");
                var membro_corpo = $("<div class='col-md-11'></div>");
                var membro_corpo_titulo = $("<div style='background-color: "+color_+"; margin-left: -12px;padding-left: 25px;color:white'><b>"+cardsFromJson[z].name+" - "+cargo+"</b></div>");
                var membro_corpo_colunas = $("<div id=''></div>");
                    
                for (let k=0;k<cardsFromJson[z].lists.length;k++){
                   
                    let cardsToList = [];

                    for (let u=0;u<cardsFromJson[z].lists[k].cards.length;u++){
                        if ((cardsFromJson[z].lists[k].cards[u].dateLastActivity.split("T")[0]>=startDate)&&(cardsFromJson[z].lists[k].cards[u].dateLastActivity.split("T")[0]<=endDate)){
                            cardsToList.push(cardsFromJson[z].lists[k].cards[u]);
                        }
                    }
                    
                    populateColumn(k,cardsToList,cardsFromJson[z].lists[k].listId,"gray",cardsFromJson[z].lists[k].listName,membro_corpo_colunas,color_);
                   
                }

                $(membro_corpo).append(membro_corpo_titulo);
                $(membro_corpo).append(membro_corpo_colunas);

                $(membro).append(membro_listra);
                $(membro).append(membro_corpo);
                        
                $(membro_completo).append(membro);

                $(membros).append(membro_completo);
                
            }

            $("#card_principal").append(cabecalho);
            $("#card_principal").append(membros);
            var $iframe = $('#iframe');
            var cssLink = document.createElement("link");
            cssLink.href = "css/styles.css"; 
            cssLink.rel = "stylesheet"; 
            cssLink.type = "text/css"; 

            $iframe.contents().find("head").append(cssLink);
            $iframe.contents().find("head").append(script_jquery);

            $iframe.contents().find("body").append($('#card_principal'));

            $iframe.contents().find("body").append(script_);
        }

        /*
        function configMember(){
            var z,x,n;

            var filteredActivities = [];
                
            var startDate = document.getElementById("date_interval_init").value;
            var endDate = document.getElementById("date_interval_end").value;

            //    alert(startDate+"\n"+endDate);

            for(z=0;z<membros_acoes_geral.length;z++){

                    let membro = {
                                membro_nome: null,
                                cards_em_demandas: [],
                                cards_em_andamento: [] ,
                                cards_concluidos: [],
                                cards_caixa_de_gelo: [],
                                cards_aguardando_resp: [],
                                cards_arquivados: [],
                                cards_agendados: [],
                                cards_voluntarios: [],
                                cargo: null,
                                membro_nome_real: "",
                                color: null
                    };

                    membros_acoes_geral[z].membro_nome_real = document.getElementById("membro_nome_real_"+z).value;
                    membro.membro_nome_real = membros_acoes_geral[z].membro_nome_real;
                    membros_acoes_geral[z].cargo = document.getElementById("cargo_"+z).value;
                    membro.cargo = membros_acoes_geral[z].cargo;
                    membros_acoes_geral[z].color = document.getElementById("color_"+z).value;
                    membro.color = membros_acoes_geral[z].color;

                    for (x=0;x<membros_acoes_geral[z].cards.length;x++){
                        
                        let status = "";
                        for (n=0;n<membros_acoes_geral[z].cards[x].actions.length;n++){
                            if(membros_acoes_geral[z].cards[x].actions[n].currentList!=""){
                                status = membros_acoes_geral[z].cards[x].actions[n].currentList;
                            }
                            //alert("membro: "+z+"cartão n°: "+x+"\nacao n°: "+n+"status: "+status);
                            //pega a ultima ação do cards e verifica qual era o ultimo status do card
                            //e se o card está no intervalo de data
                            if (n==membros_acoes_geral[z].cards[x].actions.length-1){
                                let dateCard = membros_acoes_geral[z].cards[x].actions[n].date.split("T")[0];
                                if ((dateCard>=startDate)&&(dateCard<=endDate)){
                                    alert(status);
                                  switch(status){
                                        case "Voluntariado e Prestação de Serviços":
                                            if (membro.cards_voluntarios.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_voluntarios.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        case "Agendados":
                                            if (membro.cards_agendados.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_agendados.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        case "DEMANDAS":
                                            if (membro.cards_em_demandas.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_em_demandas.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        case "Caixa de Gelo":
                                            if (membro.cards_caixa_de_gelo.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_caixa_de_gelo.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        case "EM ANDAMENTO":
                                            if (membro.cards_em_andamento.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_em_andamento.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        case "Aguardando Resposta":
                                            if (membro.cards_aguardando_resp.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_aguardando_resp.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        case "CONCLUÍDO":
                                            if (membro.cards_concluidos.indexOf(membros_acoes_geral[z].cards[x])==-1){
                                                membro.cards_concluidos.push(membros_acoes_geral[z].cards[x]);
                                            }
                                            break;
                                        default:
                                        
                                    }
                                }
                            }
                        
                        }
                    }
                    filteredActivities.push(membro);
                }

                populateHtmlReport(filteredActivities,startDate,endDate);

            }
            */
            (function() {

                //essa função detecta que foi colocado algum arquivo no input de arquivo de id "jsonfile"
                function onChange(event) {
                    var reader = new FileReader();
                    reader.onload = onReaderLoad;
                    reader.readAsText(event.target.files[0]);
                }

                function onReaderLoad(event){
                    $(".member_etiqueta_association").empty();
                    var div = $("<div></div>");
                    console.log(event.target.result);
                    var obj = JSON.parse(event.target.result);
                
                    var members = [];

                    for (let m=0;m<obj.members.length;m++){
                        let member = {
                            name: obj.members[m].fullName,
                            id: obj.members[m].id
                        }
                       // alert(member.id)
                       members.push(member);
                    }

        
                    var lists = [];

                    for (let i=0;i<obj.lists.length;i++){
                        if(!obj.lists[i].closed){
                            var list = {
                                id: obj.lists[i].id,
                                name: obj.lists[i].name,
                                idBoard: obj.lists[i].idBoard
                            }
                            //alert("id: "+ obj.lists[i].id+"\nname: "+obj.lists[i].name+"\nidboard: "+obj.lists[i].idBoard);
                            lists.push(list);
                        }
                        
                    }

                 

                var labels = [];

                    for (let p=0;p<obj.labels.length;p++){
                        var cardList = [];
                        var cardPerList = [];

                        for (let l_=0;l_<lists.length;l_++){
                            
                            var cards = [];

                            for (let j=0;j<obj.cards.length;j++){
                                    if(lists[l_].id == obj.cards[j].idList){
                                        let resultlabel = obj.cards[j].labels.filter(label => label.id == obj.labels[p].id);

                                        if(resultlabel.length>0){
                                        //cardsFromJson.push(obj.cards[j]);
                                        var checklists = [];

                                        var membersCard = [];
                                        
                                        for(let m=0;m<obj.cards[j].idMembers.length;m++) {
                                            for(let n=0;n<members.length;n++){
                                                if(obj.cards[j].idMembers[m]==members[n].id){
                                                    let member = {
                                                        id: members[n].id,
                                                        name: members[n].name
                                                    }
                                                    membersCard.push(member);
                                                }
                                            }
                                        }

                                        for (let x=0;x<obj.cards[j].idChecklists.length;x++){
                                            var result = obj.checklists.find(checklist => checklist.id == obj.cards[j].idChecklists[x]);
                                            
                                            if(result!=undefined){
                                                if(result.checkItems.length>0){
                                                    var checkItems = [];
                                                    for(let m=0;m<result.checkItems.length;m++){
                                                        var checkitemtemp = {
                                                            state: result.checkItems[m].state,
                                                            name: result.checkItems[m].name
                                                        }
                                                        checkItems.push(checkitemtemp);
                                                    }
                                                }
                                            }
                                            checklists.push({name:result.name,items: checkItems});
                                        }
                                        var actions_route = "\nROTA DA ATIVIDADE";
                                        var current_list = "";
                                        var actions = [];
                                        //actions aqui
                                        var actionsForThisCard = obj.actions.filter(action => (action.data.card!=undefined) ? (action.data.card.id == obj.cards[j].id) : undefined);
                                        for (let g=actionsForThisCard.length-1;g>=0;g--){
                                                if(actionsForThisCard[g].data.card != null){
                                                    var action = {
                                                        date: "",
                                                        text: "",
                                                        type: "",
                                                        currentList: ""
                                                    }

                                                        switch(actionsForThisCard[g].type){
                                                            case "createCard":
                                                                actions_route += "\natividade criada em "+actionsForThisCard[g].date;
                                                                actions_route += "\n------------";
                                                                action.date = actionsForThisCard[g].date;
                                                                action.text = "Foi criada";
                                                                action.type = "createCard";
                                                                actions.push(action);
                                                            break;
                                                            case "commentCard":
                                                                actions_route += "\n"+actionsForThisCard[g].idMemberCreator+" disse '"+actionsForThisCard[g].data.text+"' em "+actionsForThisCard[g].date;
                                                                actions_route += "\n------------";
                                                                action.date = actionsForThisCard[g].date;
                                                            // var memberComment = membros_obj.find(membro => membro.id.trim() == actionsForThisCard[g].idMemberCreator.trim());
                                                                action.text = "\n"+actionsForThisCard[g].memberCreator.fullName+" disse '"+actionsForThisCard[g].data.text+"'";
                                                                action.type = "commentCard";
                                                                actions.push(action);
                                                            break;
                                                            case "updateCard":
                                                                if (actionsForThisCard[g].data.list != null){
                                                                    if (current_list != actionsForThisCard[g].data.list.name) {
                                                                        actions_route += "\nmudou para status "+actionsForThisCard[g].data.list.name+" em "+actionsForThisCard[g].date;
                                                                        actions_route += "\n------------";
                                                                        current_list = actionsForThisCard[g].data.list.name;
                                                                        action.currentList = current_list;
                                                                        action.date = actionsForThisCard[g].date;
                                                                        action.type = "updateCard";
                                                                        actions.push(action);
                                                                    }
                                                                } else {
                                                                    if ((actionsForThisCard[g].data.listAfter)&&(current_list != actionsForThisCard[g].data.listAfter.name)){
                                                                        actions_route += "\nmudou para status "+actionsForThisCard[g].data.listAfter.name+" em "+actionsForThisCard[g].date;
                                                                        actions_route += "\n------------";
                                                                        current_list = actionsForThisCard[g].data.listAfter.name;
                                                                        action.date = actionsForThisCard[g].date;
                                                                        action.type = "updateCard";
                                                                        var listafter = "";
                                                                        var listbefore = "";

                                                                        switch(actionsForThisCard[g].data.listAfter.name){
                                                                            case "CONCLUÍDO":
                                                                                listafter="<p style='color:#118000;display:inline;'>"+actionsForThisCard[g].data.listAfter.name+"</p>";
                                                                                break;
                                                                            case "Caixa de Gelo":
                                                                                listafter="<p style='color:#0080ab;display:inline;'>"+actionsForThisCard[g].data.listAfter.name+"</p>";
                                                                                break;
                                                                            default:
                                                                                listafter=actionsForThisCard[g].data.listAfter.name;
                                                                                break;
                                                                        }

                                                                        switch(actionsForThisCard[g].data.listBefore.name){
                                                                            case "CONCLUÍDO":
                                                                                listbefore="<p style='color:#118000;display:inline;'>"+actionsForThisCard[g].data.listBefore.name+"</p>";
                                                                                break;
                                                                            case "Caixa de Gelo":
                                                                                listbefore="<p style='color:#0080ab;display:inline;'>"+actionsForThisCard[g].data.listBefore.name+"</p>";
                                                                                break;
                                                                            default:
                                                                                listbefore=actionsForThisCard[g].data.listBefore.name;
                                                                                break;
                                                                        }

                                                                        action.currentList = current_list;
                                                                        action.text = "Atividade mudou de "+listbefore+" para "+listafter;
                                                                        action.type = "updateCard";
                                                                        actions.push(action);
                                                                    }
                                                                }
                                                                
                                                            break;
                                                            case "addChecklistToCard":
                                                                actions_route += "\nadicionou checklist ao cartão";
                                                                actions_route += "\n------------";
                                                                action.date = actionsForThisCard[g].date;
                                                                action.text = "Checklist '"+actionsForThisCard[g].data.checklist.name+"' adicionado ao cartão";
                                                                action.type = "addChecklistToCard";
                                                                card.actions.push(action);
                                                            break;
                                                        }
                                                    
                                                }
                                        }

                                        var card = {
                                            name: obj.cards[j].name,
                                            list: (lists.find(list => list.id == obj.cards[j].idList)!=undefined) ? lists.find(list => list.id == obj.cards[j].idList).name : null,
                                            checklists: checklists,
                                            labels: obj.cards[j].labels,
                                            dateLastActivity: obj.cards[j].dateLastActivity,
                                            actions: actions,
                                            members: membersCard,
                                            attachments: obj.cards[j].attachments,
                                            description: obj.cards[j].desc
                                        }

                                        cards.push(card)
                                        }
                                    }
                            }
                            cardPerList.push({
                                listName: lists[l_].name,
                                listId: lists[l_].id,
                                cards: cards
                            });

                        }
                        let label = {
                            name: obj.labels[p].name,
                            color: obj.labels[p].color,
                            lists: cardPerList
                        }

                        if(label.name!=undefined&&label.name!=""){
                            var div_input = $("<div class='input-group' style='margin-top:10px;'></div>")
                            var input_name = $("<p id='membro_nome_real_"+p+"'>"+obj.labels[p].name+"</p>");
                            var span = $("<span class='input-group-addon'>-</span>");
                            var input_cargo = $("<input type='text' id='cargo_"+p+"' class='form-control' placeholder='Cargo'/>");

                            $(div_input).append(input_name);
                            $(div_input).append(span);
                            $(div_input).append(input_cargo);

                            $(div).append(div_input);

                            labels.push(label)
                            //alert(JSON.stringify(label));
                        }
                    }

                    cardsFromJson = labels;

                    $(".member_etiqueta_association").append("<div class='form-group row'><label for='date_interval_init' class='col-2 col-form-label'>Início</label><div class='col-10'><input class='form-control' type='date' value='2020-04-01' id='date_interval_init'></div></div>");
                    $(".member_etiqueta_association").append("<div class='form-group row'><label for='date_interval_end' class='col-2 col-form-label'>Fim</label><div class='col-10'><input class='form-control' type='date' value='2020-04-01' id='date_interval_end'></div></div>");

                    $(".member_etiqueta_association").append(div);
                }

                document.getElementById('jsonfile').addEventListener('change', onChange);
                
            }());
        </script>

        <script src="xepOnline.jqPlugin.js"></script>
        <script src="js/html2canvas.js"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/chart-area-demo.js"></script>
        <script src="assets/demo/chart-bar-demo.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>

    </body>
</html>
